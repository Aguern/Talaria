services:
  # API FastAPI - Service Web Principal
  - type: web
    name: deme-api
    runtime: docker
    plan: free
    region: frankfurt  # EU region for lower latency
    healthCheckPath: /
    envVars:
      # Note: DATABASE_URL removed - DéMé Traiteur uses Notion, not PostgreSQL
      # To re-enable database, add:
      # - key: DATABASE_URL
      #   fromDatabase:
      #     name: deme-db
      #     property: connectionString

      # Note: Redis/Celery variables removed for Render Free deployment
      # DéMé Traiteur will use FastAPI BackgroundTasks in direct mode
      # To enable Celery mode, add CELERY_BROKER_URL and CELERY_RESULT_BACKEND here

      # JWT & Encryption (manuellement depuis .env)
      - key: SECRET_KEY
        sync: false
      - key: ALGORITHM
        value: HS256
      - key: ACCESS_TOKEN_EXPIRE_MINUTES
        value: 30
      - key: FERNET_KEY
        sync: false

      # OpenAI & LLM APIs
      - key: OPENAI_API_KEY
        sync: false
      - key: PPLX_API_KEY
        sync: false

      # Notion API - DéMé Traiteur
      - key: NOTION_API_TOKEN
        sync: false
      - key: NOTION_DATABASE_CLIENTS_ID
        sync: false
      - key: NOTION_DATABASE_PRESTATIONS_ID
        sync: false
      - key: NOTION_DATABASE_CATALOGUE_ID
        sync: false
      - key: NOTION_DATABASE_LIGNES_DEVIS_ID
        sync: false
      - key: NOTION_DATABASE_INGREDIENTS_ID
        sync: false
      - key: NOTION_DATABASE_MATERIEL_ID
        sync: false
      - key: NOTION_DATABASE_RH_ID
        sync: false

      # Google Calendar API
      - key: GOOGLE_CALENDAR_CREDENTIALS
        sync: false
      - key: GOOGLE_CALENDAR_ID
        sync: false

      # Google Drive & Sheets API
      - key: GOOGLE_DRIVE_CREDENTIALS
        sync: false
      - key: GOOGLE_DRIVE_TEMPLATE_FILE_ID
        sync: false
      - key: GOOGLE_DRIVE_SHARED_FOLDER_ID
        sync: false

      # Google OAuth2 Token (for Gmail API and Drive copy operations)
      - key: GOOGLE_TOKEN_JSON
        sync: false

      # Email SMTP Configuration (for DéMé notifications)
      - key: SMTP_HOST
        value: smtp.gmail.com
      - key: SMTP_PORT
        value: 587
      - key: SMTP_USER
        sync: false
      - key: SMTP_PASSWORD
        sync: false
      - key: DEME_NOTIFICATION_EMAIL
        value: demo.nouvellerive@gmail.com

      # Admin Secret (for protected endpoints like pool reload)
      - key: ADMIN_SECRET
        sync: false

    # Build configuration (using lightweight Dockerfile for Render Free 512MB limit)
    dockerfilePath: ./Dockerfile.render
    dockerContext: .

  # Note: Worker service removed for Render Free deployment
  # DéMé Traiteur uses FastAPI BackgroundTasks instead of Celery in this configuration
  # To enable Celery mode: add CELERY_BROKER_URL and CELERY_RESULT_BACKEND to envVars

# Note: Database removed - DéMé Traiteur uses Notion for data storage
# To re-enable PostgreSQL, uncomment:
# databases:
#   - name: deme-db
#     databaseName: saas_nr_db
#     user: deme_user
#     plan: free
#     region: frankfurt
#     postgresMajorVersion: 15

# Note: Redis n'est pas disponible en free sur Render
# Il faut utiliser Upstash Redis (gratuit) ou payer
# Alternative: Créer un compte Upstash et utiliser leur Redis gratuit
# https://upstash.com/
